@using Blazor.FullCalendar.Models
@using Blazor.FullCalendar.Services
@using Microsoft.AspNetCore.Components.Web

@inject ICalendarEventFactory CalendarEventFactory;

@typeparam TCalendarEvent where TCalendarEvent : ICalendarEvent

@code {
  [Parameter] 
  public RenderFragment<TCalendarEvent>? CalendarEventTemplate { get; set; } =
      item => @<CalendarEventComponent CalendarEvent="@item"/>;
}

<CascadingValue Value="@ComponentSharedInformation">
    <div id="root" class="container" @onwheel="OnWheel">
        @if (EnableMenu)
        {
            <CalendarMenuComponent SetMenuDateDisplay="@SetMenuDateDisplay" StartingDay="@StartingDay"/>
        }
        <div class="row">
            @foreach (var day in _days)
            {
                <div class="header">@day</div>
            }
        </div>
        @for (var w = 0; w < Constants.AmountOfDisplayedWeeks; w++)
        {
            <div class="row">
                @for (var d = 0; d < Constants.AmountOfDisplayedDays; d++)
                {
                    var day = CalculateDay(w, d);
                    var todayClass = string.Empty;
                    <div class="item" @onclick="() => OnDayClick(day)">
                        @if (EnableHighlightToday)
                        {
                            todayClass = ComponentSharedInformation.Today.DayNumber == day.DayNumber ? "today" : string.Empty;
                        }
                    
                        <h2 class="@todayClass">
                            @if (EnableDistinctFirstDayOfMonth && day.Day == 1)
                            {
                                @SetFirstDayOfMonthDisplayInternal(day)
                            }
                            else
                            {
                                @SetDayDisplayInternal(day)
                            }
                        </h2>
                    
                        @if (_calendarEvents.TryGetValue(day.DayNumber, out var e))
                        {
                            @CalendarEventTemplate(e)
                        }
                    </div>
                }
            </div>
        }
    </div>
</CascadingValue>
